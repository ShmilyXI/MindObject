<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,minimum=1.0,maximum=1.0">
  <title>Title</title>
  <link rel="stylesheet" href="css/text.css">
</head>
<body>
  <div id="wrap">
    <div class="scrollBar"></div>
    <div class="head">
      <!--头部上层-->
      <div class="head-top">
        <!--logo-->
        <h1 class="logo">
          <a href="javascript:;">
            <img src="img/logo.png">
          </a>
        </h1>
        <!--面包屑导航-->
        <a href="javascript:;" class="menuBtn"></a>
        <!--按钮排-->
        <div class="btns">
          <a href="javascript:;" class="search">搜索</a>
          <a href="javascript:;">登录</a>
          <a href="javascript:;">注册</a>
        </div>
      </div>
      <!--头部下层-->
      <div class="head-bottom">
        <form method="post">
          <input type="text" placeholder="请输入内容">
          <input type="submit" value="搜索">
        </form>
      </div>
      <!--遮罩层-->
      <ul class="mask">
        <li><a href="javascript:;">首页</a></li>
        <li><a href="javascript:;">MV</a></li>
        <li><a href="javascript:;">悦单</a></li>
        <li><a href="javascript:;">V榜</a></li>
        <li><a href="javascript:;">音乐</a></li>
        <li><a href="javascript:;">商城</a></li>
        <li><a href="javascript:;">节目</a></li>
        <li><a href="javascript:;">饭团</a></li>
        <li><a href="javascript:;">咨询</a></li>
        <li><a href="javascript:;">我的家</a></li>
        <li><a href="javascript:;">APP下载</a></li>
        <li><a href="javascript:;">热门应用</a></li>
      </ul>

    </div>
    <div class="content">
      <div>
      <!--导航栏-->
      <div class="moveText-drag-nav">
        <ul class="list">
          <li><a href="javascript:;" class="active">首页</a></li>
          <li><a href="javascript:;">MV</a></li>
          <li><a href="javascript:;">悦单</a></li>
          <li><a href="javascript:;">V榜</a></li>
          <li><a href="javascript:;">音乐</a></li>
          <li><a href="javascript:;">商城</a></li>
          <li><a href="javascript:;">节目</a></li>
          <li><a href="javascript:;">饭团</a></li>
          <li><a href="javascript:;">咨询</a></li>
          <li><a href="javascript:;">我的家</a></li>
          <li><a href="javascript:;">APP下载</a></li>
          <li><a href="javascript:;">热门应用</a></li>
          <li><a href="javascript:;">节目</a></li>
          <li><a href="javascript:;">饭团</a></li>
          <li><a href="javascript:;">咨询</a></li>
          <li><a href="javascript:;">我的家</a></li>
          <li><a href="javascript:;">APP下载</a></li>
          <li><a href="javascript:;">热门应用</a></li>
        </ul>
      </div>
      <!--无缝滑屏-->
      <div class="carousel-wrap" needCarousel needAuto>
        <div class="points-wrap"></div>
      </div>
      <!--tap选项卡-->
      <div class="tap-wrap">
        <div class="tap-head">
          <h2>MV主播</h2>
          <span>更多&gt</span>
        </div>
        <div class="tap-nav">
          <a href="javascript:;">全部</a>
          <a href="javascript:;">内地</a>
          <a href="javascript:;">刚果人民共和国</a>
          <a href="javascript:;">欧美</a>
          <a href="javascript:;">韩国</a>
          <a href="javascript:;">日本</a>
          <div class="smallG"></div>
        </div>
        <div class="tap-content">
          <ul class="tap-loading"></ul>
          <ul>
            <li>
              <a href="javascript:;">
                <img src="img/a.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/b.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/c.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/d.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/e.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/f.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
          </ul>
          <ul class="tap-loading"></ul>
        </div>
      </div>
      <div class="tap-wrap">
        <div class="tap-head">
          <h2>MV主播</h2>
          <span>更多&gt</span>
        </div>
        <div class="tap-nav">
          <a href="javascript:;">全部</a>
          <a href="javascript:;">内地</a>
          <a href="javascript:;">港台</a>
          <a href="javascript:;">欧美</a>
          <a href="javascript:;">韩国</a>
          <a href="javascript:;">日本</a>
          <div class="smallG"></div>
        </div>
        <div class="tap-content">
          <ul class="tap-loading"></ul>
          <ul>
            <li>
              <a href="javascript:;">
                <img src="img/a.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/b.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/c.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/d.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/e.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/f.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
          </ul>
          <ul class="tap-loading"></ul>
        </div>
      </div>
      <div class="tap-wrap">
        <div class="tap-head">
          <h2>MV主播</h2>
          <span>更多&gt</span>
        </div>
        <div class="tap-nav">
          <a href="javascript:;">全部</a>
          <a href="javascript:;">内地</a>
          <a href="javascript:;">港台</a>
          <a href="javascript:;">欧美</a>
          <a href="javascript:;">韩国</a>
          <a href="javascript:;">日本</a>
          <div class="smallG"></div>
        </div>
        <div class="tap-content">
          <ul class="tap-loading"></ul>
          <ul>
            <li>
              <a href="javascript:;">
                <img src="img/a.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/b.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/c.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/d.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/e.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/f.jpg">
                <span>君に贈る花がないがないがないがないがないがないがない</span>
              </a>
              <div class="tap-bottom">
                <div class="left">
                  <span></span>
                  <span>9176</span>
                </div>
                <div class="right">
                  <span></span>
                  <span>6</span>
                </div>
              </div>
            </li>
          </ul>
          <ul class="tap-loading"></ul>
        </div>
      </div>
    </div>
    </div>
  </div>
</body>
<script type="text/javascript" src="js/tools.js"></script>
<script type="text/javascript" src="js/moveText.js"></script>
<script type="text/javascript">
  window.onload = function () {
    //清除默认样式
    document.addEventListener("touchstart",function (ev) {
      ev=ev||event;
      ev.preventDefault();
    })

    //选择适配方案(rem)
    ;(function () {
      var styleNode = document.createElement("style");
      var w = document.documentElement.clientWidth/16;
      styleNode.innerHTML = "html{font-size:"+w+"px!important}";
      document.head.appendChild(styleNode);
    })()

    //头部效果
    var aNodes = document.querySelectorAll("#wrap .head .head-top .btns a");
    var headBottom = document.querySelector("#wrap .head .head-bottom");
    var bar = document.querySelector("#wrap .scrollBar");
    var head = document.querySelector("#wrap .head");
    var h = head.offsetHeight;
    var flag = true;
    aNodes[0].addEventListener("touchend",function(){
      //滚动条滚过头部高度时
      if(vMove.css(bar,"translateY")>h){

        if(flag){
          headBottom.style.display="none";
        }else{
          headBottom.style.display="block";
        }
        flag=!flag;
      }
    })
    //竖向滑屏
    vMove();
    function vMove(){
      var headBottom = document.querySelector("#wrap .head .head-bottom");
      var head = document.querySelector("#wrap .head");
      var h = head.offsetHeight;
      var content = document.querySelector("#wrap .content");
      var wrap = document.querySelector("#wrap .content > div");
      var bar = document.querySelector("#wrap .scrollBar");
      var scale = document.documentElement.clientHeight/(head.offsetHeight+wrap.offsetHeight);
      bar.style.height = document.documentElement.clientHeight*scale+"px";
      var callBack={
        start:function(){
          bar.style.opacity=1;
        },
        move:function(){
          var scale = vMove.css(this,"translateY")/(wrap.offsetHeight - content.clientHeight);
          //scale = 实时距离/最大距离
          vMove.css(bar,"translateY",-scale*(document.documentElement.clientHeight -bar.offsetHeight ));

          if(vMove.css(bar,"translateY")>h){
            headBottom.style.display="none";
            flag = false;
          }else if(vMove.css(bar,"translateY")<h){
            headBottom.style.display="block";
            flag = true;
          }
        },
        autoMove:function(){
          var scale = vMove.css(this,"translateY")/(wrap.offsetHeight - content.clientHeight);
          //scale = 实时距离/最大距离
          vMove.css(bar,"translateY",-scale*(document.documentElement.clientHeight -bar.offsetHeight ));
        },
        end:function(){
          bar.style.opacity=0;
        }
      }
      moveText.vMove(content,callBack);
    }


    //tap滑屏
    /*
			一次move过程:
				touchstart事件触发一次
				touchmove 事件触发N次
				touchende 事件触发一次


			1.基本的滑屏逻辑(防抖动)
			2.结合tap选项卡的实际需求  滑屏
				---  手指一次move过程没有过1/2
							我们不关心touchmove的触发次数
				---	  手指一次move过程过1/2
							0
							-2w
							touchmove的触发次数必须只有一次

			3.一个逻辑只被触发一次
				定时器
					控制一个逻辑在一定时间内被触发一次
				立flag
					控制一个逻辑在一类操作过程中被触发一次
			*/


    /*超过 1/2
     * 1.一开始loading图是隐藏的,loading图需要出现
     * 2.发送请求  处理请求  完成数据的渲染
     * 		必须动画（content去0 或者 -2w位置）完成之后，再去进行这一系列的逻辑
     * 								----   content要回到-w的位置
     * */
    tap();
    function tap(){
      var tapWrap = document.querySelector("#wrap .content .tap-wrap")
      var tapContents = document.querySelectorAll("#wrap .content .tap-wrap .tap-content")
      var w = tapWrap.offsetWidth;
      //滑屏
      for(var i=0;i<tapContents.length;i++){
          move(tapContents[i]);
      }
      
      function move(content) {
        //获取底部小滑块
        var smallG = content.parentNode.querySelector(".tap-nav .smallG");
        var aNodes = content.parentNode.querySelectorAll(".tap-nav a");

        smallG.style.width=aNodes[0].offsetWidth+"px";
        var loadings = content.querySelectorAll(".tap-loading")
        moveText.css(content,"translateX",-w)
        var startPoint={x:0,y:0};
        var elementPoint={x:0,y:0};
        var isX = true;
        var isFirst = true;
        var now = 0;
        //二分之一事件是使整个jump逻辑干干净净
        var isOver = false;
        content.addEventListener("touchstart",function (ev) {
          // isOver = false;
          if(isOver){
            return;
          }
          ev=ev||event;
          var touchC = ev.changedTouches[0];
          startPoint.x = touchC.clientX;
          startPoint.y = touchC.clientY;
          elementPoint.x = moveText.css(content,"translateX");
          elementPoint.y = moveText.css(content,"translateY");

          isX = true;
          isFirst = true;

          content.style.transition = "none";
        })

        content.addEventListener("touchmove",function (ev) {
          if(isOver){
            return;
          }
          ev=ev||event;
          //二次防抖动
          if(!isX){
            return;
          }
          var touchC = ev.changedTouches[0];
          var nowPoint = {x:0,y:0};
          var disPoint = {x:0,y:0};

          nowPoint.x = touchC.clientX;
          nowPoint.y = touchC.clientY;
          disPoint.x = nowPoint.x -startPoint.x;
          disPoint.y = nowPoint.y -startPoint.y;

          //第一次防抖动
          if(isFirst){
            isFirst=false;
            if(Math.abs(disPoint.y)>Math.abs(disPoint.x)){
              return;
            }
          }
          var translateX = disPoint.x + elementPoint.x;
          moveText.css(content,"translateX",translateX);


          // 二分之一跳转
          jump(disPoint.x);
        })

        content.addEventListener("touchend",function (ev) {
          if(isOver){
            return;
          }
          ev=ev||event;
          var touchC = ev.changedTouches[0];
          var nowPoint = {x:0,y:0};
          var disPoint = {x:0,y:0};
          nowPoint.x = touchC.clientX;
          disPoint.x = nowPoint.x -startPoint.x;

          if(Math.abs(disPoint.x) <= w/2){
            content.style.transition = "1s transform";
            moveText.css(content,"translateX",-w)
          }
        })

        function jump(disPointX) {
          if(isOver){
            return;
          }
          if(Math.abs(disPointX) > w/2){
            content.style.transition = "1s transform";
            isOver=true;
            var targetX = disPointX>0?0:-2*w
            moveText.css(content,"translateX",targetX)
            /*if(disPointX>0){
              //右
              moveText.css(content,"translateX",0)
            }else{
              //左
              moveText.css(content,"translateX",-2*w)
            }*/

            //在动画执行完毕后再发请求
            content.addEventListener("transitionend",endFn);
            content.addEventListener("webkitTransisionEnd",endFn);
            /*
             循环定时器   			            	回调函数的头部第一行清定时器
              DOM2 绑定 transitionend事件    回调函数的头部第一行解绑事件
            */
            function endFn() {
              /*超过 1/2
             * 1.一开始loading图是隐藏的,loading图需要出现（ 1/2跳转后  请求发送前）
             * 2.发送请求  处理请求  完成数据的渲染
             * 		必须动画（content去0 或者 -2w位置）完成之后，再去进行这一系列的逻辑
             * 								----   content要回到-w的位置
             * */
              content.removeEventListener("transitionend",endFn);
              content.removeEventListener("webkitTransisionEnd",endFn);
              content.style.transition = "none";

              for (i=0;i<loadings.length;i++){
                loadings[i].style.opacity = 1;
              }
              disPointX>0?now--:now++;
              smallG.style.transition=".8s transform,1s width"
              if(now<0){
                now=aNodes.length-1;
                smallG.style.transition=".5s transform,1s width"
              }else if(now>aNodes.length-1){
                now = 0;
                smallG.style.transition=".5s transform,1s width"
              }
              moveText.css(smallG,"translateX",aNodes[now].offsetLeft)
              if(aNodes[now].offsetWidth != smallG.offsetWidth){
                smallG.style.width = aNodes[now].offsetWidth+"px";
              }


              setTimeout(function () {
                moveText.css(content,"translateX",-w);
                isOver = false;
              },500)
            }
          }
        }
      }
    }


    // 事件委托&导航点击变色
    changeColor();
    /*第三种 事件委派  LI==>a（将a标签热区与li同步）*/
    function changeColor(){
      var listNode = document.querySelector("#wrap .content .moveText-drag-nav .list")
      //var listLis = document.querySelectorAll("#wrap .content .moveText-drag-nav .list > li")
      var listAs = document.querySelectorAll("#wrap .content .moveText-drag-nav .list > li >a")

      listNode.addEventListener("touchstart",function (ev) {
            this.isMove=false;
      })
      listNode.addEventListener("touchmove",function (ev) {
            this.isMove=true;
      })
      listNode.addEventListener("touchend",function (ev) {
        if(this.isMove){
          return;
        }
        ev=ev||event;
        var TouchC = ev.changedTouches[0];
        for(var i=0;i<listAs.length;i++){
          tools.removeClass(listAs[i],"active")
        }
        tools.addClass(TouchC.target,"active")
      })
      /*第二种 事件委派 LI(对TouchC.target里面的a、li进行判断)
  function changeColor(){
    var listNode = document.querySelector("#wrap .content .moveText-drag-nav .list")
    var listLis = document.querySelectorAll("#wrap .content .moveText-drag-nav .list > li")
    listNode.addEventListener("touchstart",function (ev) {
        this.isMove = false;
    })
    listNode.addEventListener("touchmove",function (ev) {
        this.isMove = true;
    })
    listNode.addEventListener("touchend",function (ev) {
          if(this.isMove){
          return;
          }
      ev=ev||event;
      var TouchC = ev.changedTouches[0];
      for(var i=0;i<listLis.length;i++){
         tools.removeClass(listLis[i],"active")
       }
      if(TouchC.target.nodeName.toUpperCase()==="A"){
        tools.addClass(TouchC.target.parentNode,"active")
      }else if(TouchC.target.nodeName.toUpperCase()==="LI"){
        tools.addClass(TouchC.target,"active")
      }

    })
  }*/

      /*
            第一种 双层for循环嵌套
      function changeColor(){
        var liNodes = document.querySelectorAll("#wrap .content .moveText-drag-nav .list>li")
        for(var i=0;i<liNodes.length;i++){
          liNodes[i].addEventListener("touchstart",function () {
              this.isMove = false;
          })
          liNodes[i].addEventListener("touchmove",function () {
              this.isMove = true;
          })
          liNodes[i].addEventListener("touchend",function () {

            if(!this.isMove){
              for(var i=0;i<liNodes.length;i++){
                tools.removeClass(liNodes[i],"active");
              }
              tools.addClass(this,"active");
            }
          })
        }
      }*/
    }


    //无缝滑屏
    swiper();
    function swiper() {
      var arr = ["img/1.jpg", "img/2.jpg", "img/3.jpg", "img/4.jpg", "img/5.jpg",];
      moveText.carousel(arr);
    }

    //导航拖拽
    drag();
    function drag(){
      moveText.nav();
    }

    //搜索栏高亮
    changeFoucs();
    function changeFoucs(){
      var inputNode = document.querySelector("#wrap .head .head-bottom form input[type=\"text\"]");
      inputNode.addEventListener("touchstart",function (ev) {
        ev=ev||event;
        this.focus();
        ev.stopPropagation();
        ev.preventDefault();
      })
      document.addEventListener("touchstart",function (){
        inputNode.blur();
      })
    }

    //遮罩层
    CMCFMenuBtn()
    function CMCFMenuBtn(ev) {
        ev=ev||event;
        var menuBtn = document.querySelector("#wrap .head .head-top .menuBtn");
        var mask = document.querySelector("#wrap .head .mask");
        var isXX=false;
        menuBtn.addEventListener("touchstart",function (ev) {
          ev=ev||event;
          var touchC = ev.changedTouches[0];
          if(!isXX){
            tools.addClass(menuBtn,"active");
            mask.style.display="block";
          }else{
            tools.removeClass(menuBtn,"active");
            mask.style.display="none";
          }
          ev.stopPropagation();
          ev.preventDefault();
          isXX=!isXX;
        })
       document.addEventListener("touchstart",function (){
          if(isXX){
            tools.removeClass(menuBtn,"active");
            mask.style.display="none";
          }
          isXX=!isXX;
       })
      mask.addEventListener("touchstart",function (ev) {
        ev=ev||event;
        ev.stopPropagation();
        ev.preventDefault();
      })
    }
  }
</script>
</html>